@using HolyConnect.Infrastructure.Services
@using HolyConnect.Application.Interfaces

<!-- Repository Status -->
<MudCard Class="mb-4">
    <MudCardContent>
        <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center" Class="mb-3">
            <MudText Typo="Typo.h6">Repository Status</MudText>
            <MudButton Variant="Variant.Outlined" 
                      Color="Color.Info" 
                      OnClick="OnRefresh"
                      StartIcon="@Icons.Material.Filled.Refresh"
                      Size="Size.Small"
                      Disabled="IsLoading">
                Refresh
            </MudButton>
        </MudStack>
        
        <MudGrid>
            <MudItem xs="12" sm="6" md="3">
                <MudPaper Class="pa-3" Outlined="true">
                    <MudStack Spacing="1">
                        <MudIcon Icon="@Icons.Material.Filled.Source" Color="Color.Info" />
                        <MudText Typo="Typo.caption">Current Branch</MudText>
                        <MudText Typo="Typo.body1">
                            <strong>@(CurrentBranch ?? "Unknown")</strong>
                        </MudText>
                    </MudStack>
                </MudPaper>
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudPaper Class="pa-3" Outlined="true">
                    <MudStack Spacing="1">
                        <MudIcon Icon="@Icons.Material.Filled.Edit" Color="@(Status?.ModifiedFiles > 0 ? Color.Warning : Color.Default)" />
                        <MudText Typo="Typo.caption">Modified</MudText>
                        <MudText Typo="Typo.body1">
                            <strong>@(Status?.ModifiedFiles ?? 0) files</strong>
                        </MudText>
                    </MudStack>
                </MudPaper>
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudPaper Class="pa-3" Outlined="true">
                    <MudStack Spacing="1">
                        <MudIcon Icon="@Icons.Material.Filled.CloudDownload" Color="@(IncomingCommits.Any() ? Color.Info : Color.Default)" />
                        <MudText Typo="Typo.caption">Incoming</MudText>
                        <MudText Typo="Typo.body1">
                            <strong>@IncomingCommits.Count() commits</strong>
                        </MudText>
                    </MudStack>
                </MudPaper>
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudPaper Class="pa-3" Outlined="true">
                    <MudStack Spacing="1">
                        <MudIcon Icon="@Icons.Material.Filled.CloudUpload" Color="@(OutgoingCommits.Any() ? Color.Warning : Color.Default)" />
                        <MudText Typo="Typo.caption">Outgoing</MudText>
                        <MudText Typo="Typo.body1">
                            <strong>@OutgoingCommits.Count() commits</strong>
                        </MudText>
                    </MudStack>
                </MudPaper>
            </MudItem>
        </MudGrid>

        @if (IncomingCommits.Any() || OutgoingCommits.Any())
        {
            <MudGrid Class="mt-3">
                @if (IncomingCommits.Any())
                {
                    <MudItem xs="12" md="6">
                        <MudText Typo="Typo.subtitle2" Class="mb-2">Incoming Commits:</MudText>
                        <MudList T="string" Dense="true" Class="ml-2">
                            @foreach (var commit in IncomingCommits.Take(5))
                            {
                                <MudListItem T="string">
                                    <MudText Typo="Typo.body2">
                                        <strong>@commit.ShortSha</strong> - @commit.Message
                                        <br />
                                        <span style="font-size: 0.8em; color: gray;">@commit.Author - @commit.Date.ToString("yyyy-MM-dd HH:mm")</span>
                                    </MudText>
                                </MudListItem>
                            }
                            @if (IncomingCommits.Count() > 5)
                            {
                                <MudListItem T="string">
                                    <MudText Typo="Typo.caption">... and @(IncomingCommits.Count() - 5) more</MudText>
                                </MudListItem>
                            }
                        </MudList>
                    </MudItem>
                }
                @if (OutgoingCommits.Any())
                {
                    <MudItem xs="12" md="6">
                        <MudText Typo="Typo.subtitle2" Class="mb-2">Outgoing Commits:</MudText>
                        <MudList T="string" Dense="true" Class="ml-2">
                            @foreach (var commit in OutgoingCommits.Take(5))
                            {
                                <MudListItem T="string">
                                    <MudText Typo="Typo.body2">
                                        <strong>@commit.ShortSha</strong> - @commit.Message
                                        <br />
                                        <span style="font-size: 0.8em; color: gray;">@commit.Author - @commit.Date.ToString("yyyy-MM-dd HH:mm")</span>
                                    </MudText>
                                </MudListItem>
                            }
                            @if (OutgoingCommits.Count() > 5)
                            {
                                <MudListItem T="string">
                                    <MudText Typo="Typo.caption">... and @(OutgoingCommits.Count() - 5) more</MudText>
                                </MudListItem>
                            }
                        </MudList>
                    </MudItem>
                }
            </MudGrid>
        }

        @if (Status?.HasChanges == true)
        {
            <MudText Typo="Typo.subtitle2" Class="mt-3 mb-2">Changes:</MudText>
            <MudList T="string" Dense="true" Class="ml-2">
                @foreach (var change in Status.Changes.Take(10))
                {
                    <MudListItem T="string">
                        <MudText Typo="Typo.body2">@change</MudText>
                    </MudListItem>
                }
                @if (Status.Changes.Count > 10)
                {
                    <MudListItem T="string">
                        <MudText Typo="Typo.caption">... and @(Status.Changes.Count - 10) more</MudText>
                    </MudListItem>
                }
            </MudList>
        }

    </MudCardContent>
</MudCard>

@code {
    [Parameter] public string? CurrentBranch { get; set; }
    [Parameter] public GitStatus? Status { get; set; }
    [Parameter] public IEnumerable<GitCommitInfo> IncomingCommits { get; set; } = Enumerable.Empty<GitCommitInfo>();
    [Parameter] public IEnumerable<GitCommitInfo> OutgoingCommits { get; set; } = Enumerable.Empty<GitCommitInfo>();
    [Parameter] public bool IsLoading { get; set; }
    [Parameter] public EventCallback OnRefresh { get; set; }
}
