@using HolyConnect.Infrastructure.Services

<!-- Branch Operations -->
<MudCard Class="mb-4">
    <MudCardContent>
        <MudText Typo="Typo.h6" Class="mb-3">Branch Operations</MudText>
        
        <MudText Typo="Typo.subtitle2" Class="mb-2">Switch Branch:</MudText>
        <MudGrid>
            <MudItem xs="12" sm="8">
                <MudSelect @bind-Value="SelectedBranch" 
                          Label="Select Branch" 
                          Variant="Variant.Outlined"
                          T="string">
                    @foreach (var branch in Branches)
                    {
                        <MudSelectItem Value="@branch">@branch</MudSelectItem>
                    }
                </MudSelect>
            </MudItem>
            <MudItem xs="12" sm="4">
                <MudButton Variant="Variant.Filled" 
                          Color="Color.Primary" 
                          OnClick="HandleSwitchBranch"
                          Disabled="@(string.IsNullOrEmpty(SelectedBranch) || SelectedBranch == CurrentBranch)"
                          FullWidth="true"
                          StartIcon="@Icons.Material.Filled.Sync">
                    Switch
                </MudButton>
            </MudItem>
        </MudGrid>

        <MudDivider Class="my-3" />

        <MudText Typo="Typo.subtitle2" Class="mb-2">Create New Branch:</MudText>
        <MudGrid>
            <MudItem xs="12" sm="8">
                <MudTextField @bind-Value="NewBranchName" 
                             Label="Branch Name" 
                             Variant="Variant.Outlined" />
            </MudItem>
            <MudItem xs="12" sm="4">
                <MudButton Variant="Variant.Filled" 
                          Color="Color.Success" 
                          OnClick="HandleCreateBranch"
                          Disabled="@string.IsNullOrWhiteSpace(NewBranchName)"
                          FullWidth="true"
                          StartIcon="@Icons.Material.Filled.Add">
                    Create
                </MudButton>
            </MudItem>
        </MudGrid>

        <MudDivider Class="my-3" />

        <MudText Typo="Typo.subtitle2" Class="mb-2">Delete Branch:</MudText>
        <MudGrid>
            <MudItem xs="12" sm="8">
                <MudSelect @bind-Value="BranchToDelete" 
                          Label="Select Branch to Delete" 
                          Variant="Variant.Outlined"
                          T="string">
                    @foreach (var branch in Branches.Where(b => b != CurrentBranch))
                    {
                        <MudSelectItem Value="@branch">@branch</MudSelectItem>
                    }
                </MudSelect>
            </MudItem>
            <MudItem xs="12" sm="4">
                <MudButton Variant="Variant.Filled" 
                          Color="Color.Error" 
                          OnClick="HandleDeleteBranch"
                          Disabled="@string.IsNullOrEmpty(BranchToDelete)"
                          FullWidth="true"
                          StartIcon="@Icons.Material.Filled.Delete">
                    Delete
                </MudButton>
            </MudItem>
        </MudGrid>
    </MudCardContent>
</MudCard>

@code {
    [Parameter] public string? CurrentBranch { get; set; }
    [Parameter] public List<string> Branches { get; set; } = new();
    [Parameter] public string? SelectedBranch { get; set; }
    [Parameter] public EventCallback<string?> SelectedBranchChanged { get; set; }
    [Parameter] public string NewBranchName { get; set; } = string.Empty;
    [Parameter] public EventCallback<string> NewBranchNameChanged { get; set; }
    [Parameter] public string? BranchToDelete { get; set; }
    [Parameter] public EventCallback<string?> BranchToDeleteChanged { get; set; }
    
    [Parameter] public EventCallback OnSwitchBranch { get; set; }
    [Parameter] public EventCallback OnCreateBranch { get; set; }
    [Parameter] public EventCallback OnDeleteBranch { get; set; }

    private async Task HandleSwitchBranch()
    {
        await OnSwitchBranch.InvokeAsync();
    }

    private async Task HandleCreateBranch()
    {
        await OnCreateBranch.InvokeAsync();
    }

    private async Task HandleDeleteBranch()
    {
        await OnDeleteBranch.InvokeAsync();
    }
}
