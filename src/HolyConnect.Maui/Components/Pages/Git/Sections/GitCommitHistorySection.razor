@using HolyConnect.Infrastructure.Services

<!-- Commit History -->
<MudExpansionPanels Class="mb-4">
    <MudExpansionPanel @bind-IsExpanded="IsExpanded">
        <TitleContent>
            <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center" Style="width: 100%;">
                <MudText Typo="Typo.h6">Commit History</MudText>
                <MudButton Variant="Variant.Outlined" 
                          Color="Color.Info" 
                          OnClick="HandleRefresh"
                          StartIcon="@Icons.Material.Filled.Refresh"
                          Size="Size.Small"
                          Disabled="IsLoading"
                          OnClick:StopPropagation="true">
                    Refresh
                </MudButton>
            </MudStack>
        </TitleContent>
        <ChildContent>
            @if (CommitHistory.Any())
            {
                <MudPaper Class="pa-3" Outlined="true" Style="max-height: 31.25rem; overflow-y: auto;">
                    <MudList T="string" Dense="true">
                        @foreach (var commit in CommitHistory)
                        {
                            <MudListItem T="string">
                                <MudText Typo="Typo.body2">
                                    <MudChip Size="Size.Small" Color="Color.Primary" Variant="Variant.Text">@commit.ShortSha</MudChip>
                                    <strong>@commit.Message</strong>
                                    <br />
                                    <span style="font-size: 0.8em; color: gray;">
                                        @commit.Author - @commit.Date.ToString("yyyy-MM-dd HH:mm:ss")
                                    </span>
                                </MudText>
                            </MudListItem>
                        }
                    </MudList>
                </MudPaper>
            }
            else
            {
                <MudAlert Severity="Severity.Info">No commit history available.</MudAlert>
            }
        </ChildContent>
    </MudExpansionPanel>
</MudExpansionPanels>

@code {
    [Parameter] public IEnumerable<GitCommitInfo> CommitHistory { get; set; } = Enumerable.Empty<GitCommitInfo>();
    [Parameter] public bool IsExpanded { get; set; }
    [Parameter] public EventCallback<bool> IsExpandedChanged { get; set; }
    [Parameter] public bool IsLoading { get; set; }
    [Parameter] public EventCallback OnRefresh { get; set; }

    private async Task HandleRefresh()
    {
        await OnRefresh.InvokeAsync();
    }
}
